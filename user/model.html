

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Model &mdash; RESTBuilder 0.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="RESTBuilder 0.0.1 documentation" href="../index.html"/>
        <link rel="next" title="View" href="view.html"/>
        <link rel="prev" title="Database" href="database.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> RESTBuilder
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">User documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#cohorte">Cohorte</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#retrieve-restbuilder">Retrieve RESTBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#configure-restbuilder">Configure RESTBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#run-the-api">Run the API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#facilities">Facilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#records">Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tabledefinitions">TableDefinitions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="view.html">View</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller.html">Controller</a></li>
</ul>
<p class="caption"><span class="caption-text">Developper documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/doc.html">Sources documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../restbuilder/restbuilder.html">restbuilder</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../restbuilder/restbuilder.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../restbuilder/restbuilder.controllers.html">controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../restbuilder/restbuilder.models.html">models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../restbuilder/restbuilder.views.html">views</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../restbuilder/restbuilder.html#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../restbuilder/restbuilder.database.html">database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../restbuilder/restbuilder.html#module-restbuilder">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">About RESTBuilder</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#id1">0.1.0 (2015-08-15)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#id2">0.0.1 (2015-08-06)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../evolutions.html">Future Evolutions</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">RESTBuilder</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Model</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/model.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="model">
<h1>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h1>
<p>In CohorteAPI, a model is always composed of two classes : a Facilities and a Record.</p>
<ul class="simple">
<li>A <strong>Record</strong> is a class Mapping a Table in the database. Record objects can be loaded from the database or stored into it. Once created, Record classes are registered using the service RESTBuidler-records.</li>
<li>A <strong>Facilities</strong> is a class used to create, load, save and delete Record objects. It is thus a factory with a few extra features. A Facilities is a Cohorte component. It is within Facilities that Record class they handle are defined.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of today, Record classes are manually created. However, there is work in progress to generate these classes from their definitions (see <a class="reference internal" href="#tabledefinitions"><span>TableDefinitions</span></a>).</p>
</div>
<div class="section" id="facilities">
<span id="id1"></span><h2>Facilities<a class="headerlink" href="#facilities" title="Permalink to this headline">¶</a></h2>
<p>A Facilities is a Cohorte component. Even though it is not mandatory, it is advised that Facilities
should extend <a class="reference external" href="../restbuilder/restbuilder.models.facilities.html">AbstractFacilities</a> or one of its
subclasses. And since it manages Records in the database, it requires the two database manager
components : RESTBuilder-database and RESTBuilder-records.</p>
<p>Therefore, the class definition should look like this :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@ComponentFactory</span><span class="p">(</span><span class="s">&quot;myapp.models.users_factory&quot;</span><span class="p">)</span>
<span class="nd">@Provides</span><span class="p">(</span><span class="s">&quot;myapp.models.users&quot;</span><span class="p">)</span>
<span class="nd">@Requires</span><span class="p">(</span><span class="s">&quot;_db&quot;</span><span class="p">,</span> <span class="s">&quot;restbuilder.database&quot;</span><span class="p">)</span>
<span class="nd">@Requires</span><span class="p">(</span><span class="s">&quot;_records&quot;</span><span class="p">,</span> <span class="s">&quot;restbuilder.records&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UserFacilities</span><span class="p">(</span><span class="n">AbstractFacilities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    User Facilities</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Within Facilities classes, in functions decorated with &#64;Validate, are defined <a class="reference internal" href="#records"><span>Records</span></a>.</p>
<p>Inside that class could then be any functions you would like. Here are two examples :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve all users from the database</span>

<span class="sd">    :return: list of Users</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wSession</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">wResult</span> <span class="o">=</span> <span class="n">wSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getRecord</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">wSession</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wResult</span>


<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aUuid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the User with the given uuid from the database.</span>
<span class="sd">    The Role of that user will be retrieved at the same time</span>

<span class="sd">    :return: User</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wSession</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">wResult</span> <span class="o">=</span> <span class="n">wSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getRecord</span><span class="p">())</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="s">&#39;role&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aUuid</span><span class="p">)</span>
    <span class="n">wSession</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wResult</span>
</pre></div>
</div>
<p>See a full Facilities class : <a class="reference external" href="#LINK">UserFacilities</a></p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Link to a file containing the full UserFacilities</p>
</div>
</div>
<div class="section" id="records">
<span id="id2"></span><h2>Records<a class="headerlink" href="#records" title="Permalink to this headline">¶</a></h2>
<p>Record classes must extends two classes :</p>
<ul class="simple">
<li><strong>Base</strong> : Base is a class provided by function base() in the component CohorteAPI-database. By extending this class, the Record is automatically added to the database metadata. And therefore, the mapping of the database is handled automatically too. (Repoty to SQLAlchemy documentation for more details about the Base)</li>
<li><a class="reference external" href="../restbuilder/restbuilder.models.record.html">AbstractRecord</a> : An abstract class providing a couple usefull method and forcing the presence of the function __makeTableDef__() (see documentation about <a class="reference internal" href="#tabledefinitions">tabledefinitions</a>).</li>
</ul>
<p>A Record class must always be created by the Facilities class handling it. And since it needs to
used some of the components requires, the class is created in a method with the decorate &#64;Validate.
Here is an example of a class RecordUser found in the class UserFacilities.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@Validate</span>
<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the record class associated to this Facility</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wBase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">base</span><span class="p">()</span>
    <span class="n">wTableDef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeTableDef</span><span class="p">()</span>
    <span class="k">class</span> <span class="nc">RecordUser</span><span class="p">(</span><span class="n">wBase</span><span class="p">,</span> <span class="n">AbstractRecord</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mapping of the Users table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;Users&#39;</span>
        <span class="n">__tabledef__</span> <span class="o">=</span> <span class="n">wTableDef</span>

        <span class="n">uuid</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&lt;User(uuid=</span><span class="si">%s</span><span class="s">, email=</span><span class="si">%s</span><span class="s">, role=</span><span class="si">%r</span><span class="s">)&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_id</span><span class="p">)</span>
</pre></div>
</div>
<p>__makeTableDef__() is a function that creates a <a class="reference internal" href="#tabledefinitions"><span>TableDefinitions</span></a></p>
</div>
<div class="section" id="tabledefinitions">
<span id="id3"></span><h2>TableDefinitions<a class="headerlink" href="#tabledefinitions" title="Permalink to this headline">¶</a></h2>
<p>In the module restbuilder.models.definitions are found 3 classes :</p>
<ul class="simple">
<li>TableDefinition</li>
<li>ColumnDefinition</li>
<li>RelationDefinition</li>
</ul>
<p>Combined, it is possible to describe precisely a database Table. Therefore, using these classes, it
is possible to add a set of verification tests before sending request to the database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since a TableDefinition describes a Table, just like a Record, there is work in progress to use these descriptions to define the RecordClasses</p>
</div>
<p>Here is the definition of the Table `Users` :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__makeTableDef__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the TableDefinition of the Users table</span>

<span class="sd">    :return: TableDefinition of the Users Table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wTable</span> <span class="o">=</span> <span class="n">TableDefinition</span><span class="p">(</span><span class="s">&#39;Users&#39;</span><span class="p">)</span>
    <span class="n">wForeignRecord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roles</span><span class="o">.</span><span class="n">getRecord</span><span class="p">()</span>
    <span class="n">wForeignName</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.id&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wForeignRecord</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>
    <span class="n">wTable</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">ColumnDefinition</span><span class="p">(</span><span class="s">&#39;uuid&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="n">aPrimaryKey</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
    <span class="n">wTable</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">ColumnDefinition</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">aNullable</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="n">wTable</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">ColumnDefinition</span><span class="p">(</span><span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">aNullable</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="n">wTable</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">ColumnDefinition</span><span class="p">(</span><span class="s">&#39;role_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">aForeignKey</span><span class="o">=</span><span class="n">wForeignName</span><span class="p">))</span>
    <span class="n">wTable</span><span class="o">.</span><span class="n">addRelation</span><span class="p">(</span><span class="n">RelationDefinition</span><span class="p">(</span><span class="s">&#39;role&#39;</span><span class="p">,</span> <span class="n">wForeignRecord</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wTable</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="view.html" class="btn btn-neutral float-right" title="View" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="database.html" class="btn btn-neutral" title="Database" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Isandlatech.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>